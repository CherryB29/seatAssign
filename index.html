<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>자리 뽑기 프로그램</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .student-count {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #1976d2;
      font-weight: bold;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 50px);
      grid-template-rows: repeat(6, 50px);
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      transition: all 0.3s;
      perspective: 700px;
    }
    .cell {
      width: 50px;
      height: 50px;
      border: 1px solid #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: linear-gradient(135deg, #f8fafc 60%, #e3f2fd 100%);
      border: 1.5px solid #b0bec5;
      border-radius: 6px;
      font-weight: bold;
      user-select: none;
      transition: background 0.3s, color 0.3s, transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.10), 0 1.5px 4px rgba(76, 175, 80, 0.08);
    }
    .cell.active {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      color: #fff;
      border: 2.5px solid #43e97b;
      animation: pop 0.22s;
      transform: scale(1.04);
      box-shadow: 0 4px 16px rgba(67, 233, 123, 0.18);
    }
    .cell.assigned {
      background: linear-gradient(135deg, #1976d2 60%, #64b5f6 100%) !important;
      color: #fff !important;
      border: 2.5px solid #1976d2;
      animation: assignPop 0.4s;
      box-shadow: 0 4px 16px rgba(25, 118, 210, 0.18);
      transition: background 0.7s, color 0.7s, border 0.7s;
    }
    .cell.fixed {
      background: repeating-linear-gradient(135deg, #fffbe7 0 8px, #ffe082 8px 16px);
      color: #bfa600 !important;
      border: 2.5px solid #ffb300 !important;
    }
    button {
      margin-top: 15px;
      padding: 12px 22px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(90deg, #1976d2 60%, #43e97b 100%);
      color: #fff;
      font-weight: bold;
      font-size: 1.08em;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.10);
      transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
    }
    button:hover {
      background: linear-gradient(90deg, #125ea7 60%, #43e97b 100%);
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 4px 16px rgba(25, 118, 210, 0.18);
    }
    @keyframes pop {
      0% { transform: scale(0.8);}
      80% { transform: scale(1.12);}
      100% { transform: scale(1.08);}
    }
    @keyframes assignPop {
      0% { background: #4caf50; transform: scale(1);}
      60% { background: #1976d2; transform: scale(1.18);}
      100% { background: #1976d2; transform: scale(1);}
    }
    @keyframes fadeSlide {
      0% {
        opacity: 0;
        transform: translateY(12px) scale(0.9);
      }
      60% {
        opacity: 1;
        transform: translateY(-4px) scale(1.12);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1.04);
      }
    }
    .fade-slide {
      animation: fadeSlide 0.28s cubic-bezier(.68,-0.55,.27,1.55);
    }
    @keyframes shake {
      0% { transform: scale(1.04) rotate(0deg);}
      20% { transform: scale(1.08) rotate(-2deg);}
      40% { transform: scale(1.10) rotate(2deg);}
      60% { transform: scale(1.08) rotate(-1deg);}
      80% { transform: scale(1.04) rotate(1deg);}
      100% { transform: scale(1.04) rotate(0deg);}
    }
    .shaking {
      animation: shake 0.6s infinite;
    }
    .grid.blur {
      filter: blur(3px) brightness(0.9);
      pointer-events: none;
      transition: filter 0.3s;
    }
    /* 모바일 대응 */
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: repeat(5, 36px);
        grid-template-rows: repeat(12, 36px);
        gap: 6px;
      }
      .cell {
        width: 36px;
        height: 36px;
        font-size: 0.95em;
      }
    }
    @media (max-width: 400px) {
      .grid {
        grid-template-columns: repeat(3, 28px);
        grid-template-rows: repeat(20, 28px);
        gap: 4px;
      }
      .cell {
        width: 28px;
        height: 28px;
        font-size: 0.8em;
      }
    }
  </style>
</head>
<body>
  <h1>자리 뽑기 프로그램 🎲</h1>
  <div id="clock" style="font-size:1.15em; font-weight:bold; color:#1976d2; margin-bottom:8px;"></div>
  <div class="student-count" id="studentCount">학생 수: 0</div>
  <p>칸을 클릭해 활성화/비활성화 시킨 뒤 "자리 뽑기" 버튼을 누르세요.</p>

  <button onclick="assignSeats()">자리 뽑기</button>
  <button
    onclick="resetAllCells()"
    style="margin-left:10px; background:linear-gradient(90deg,#1976d2 60%,#43e97b 100%); color:#fff; border:none;"
  >
    전체 초기화
  </button>

  <div style="margin:14px 0 0 0;">
    <label style="display:inline-flex;align-items:center;gap:6px;">
      <input type="checkbox" id="dramaticMode" style="accent-color:#1976d2;">
      <span style="font-size:1em;color:#1976d2;font-weight:bold;">긴장감 넘치는 자리배치</span>
    </label>
  </div>

  <div class="grid" id="grid" style="margin-top:32px;"></div>

<script>
let rows = 6;
let cols = 10;
const grid = document.getElementById("grid");
const studentCount = document.getElementById("studentCount");

// 격자 생성 함수
function createGrid() {
  grid.innerHTML = "";
  grid.style.gridTemplateColumns = `repeat(${cols}, 50px)`;
  grid.style.gridTemplateRows = `repeat(${rows}, 50px)`;
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.active = "false";
      cell.onclick = () => toggleCell(cell);
      grid.appendChild(cell);
    }
  }
  updateStudentCount();
}
createGrid();

function updateStudentCount() {
  const count = document.querySelectorAll(".cell[data-active='true']").length;
  studentCount.innerText = `학생 수: ${count}`;
}

// 기존 칸 활성화/비활성화 함수
function toggleCell(cell) {
  if (cell.dataset.active === "false") {
    cell.dataset.active = "true";
    cell.classList.add("active");
    cell.classList.remove("assigned");
  } else {
    cell.dataset.active = "false";
    cell.classList.remove("active", "assigned");
    cell.innerText = ""; // 비활성화 시 숫자 제거
  }
  updateStudentCount();
}

let isDragging = false;
let dragMode = null;
let dragStartCell = null;

// PC 마우스
grid.addEventListener('mousedown', e => {
  if (e.target.classList.contains('cell')) {
    isDragging = true;
    dragStartCell = e.target;
    dragMode = e.target.dataset.active === "true" ? "off" : "on";
    toggleCellByDrag(e.target);
  }
});
grid.addEventListener('mouseover', e => {
  if (isDragging && e.target.classList.contains('cell')) {
    toggleCellByDrag(e.target);
  }
});
window.addEventListener('mouseup', e => {
  if (isDragging && dragStartCell && e.target === dragStartCell) {
    toggleCell(dragStartCell);
  }
  isDragging = false;
  dragMode = null;
  dragStartCell = null;
});

// 모바일 터치
let lastTouchedCell = null;
let touchStartCell = null;
grid.addEventListener('touchstart', e => {
  const touch = e.touches[0];
  const target = document.elementFromPoint(touch.clientX, touch.clientY);
  if (target && target.classList.contains('cell')) {
    isDragging = true;
    dragMode = target.dataset.active === "true" ? "off" : "on";
    lastTouchedCell = target;
    touchStartCell = target;
    toggleCellByDrag(target);
  }
});
grid.addEventListener('touchmove', e => {
  if (!isDragging) return;
  const touch = e.touches[0];
  const target = document.elementFromPoint(touch.clientX, touch.clientY);
  if (target && target.classList.contains('cell') && target !== lastTouchedCell) {
    toggleCellByDrag(target);
    lastTouchedCell = target;
  }
});
window.addEventListener('touchend', e => {
  if (isDragging && touchStartCell && lastTouchedCell === touchStartCell) {
    toggleCell(touchStartCell);
  }
  isDragging = false;
  dragMode = null;
  lastTouchedCell = null;
  touchStartCell = null;
});

// 드래그 활성화/비활성화
function toggleCellByDrag(cell) {
  if (dragMode === "on" && cell.dataset.active === "false") {
    cell.dataset.active = "true";
    cell.classList.add("active");
    cell.classList.remove("assigned");
    updateStudentCount();
  } else if (dragMode === "off" && cell.dataset.active === "true") {
    cell.dataset.active = "false";
    cell.classList.remove("active", "assigned");
    cell.innerText = "";
    updateStudentCount();
  }
}

// 자리 배정
function assignSeats() {
  const activeCells = Array.from(document.querySelectorAll(".cell[data-active='true']"));
  const total = activeCells.length;
  if (total === 0) {
    alert("활성화된 자리가 없습니다!");
    return;
  }

  const dramatic = document.getElementById('dramaticMode').checked;
  const numbers = Array.from({ length: total }, (_, i) => i + 1);
  shuffle(numbers);

  // 모든 칸에서 이전 배정 효과 제거
  document.querySelectorAll(".cell.assigned").forEach(cell => cell.classList.remove("assigned"));

  if (!dramatic) {
    activeCells.forEach((cell, i) => {
      cell.innerText = numbers[i];
      cell.classList.add("assigned");
    });
    return;
  }

  // 각 칸마다 랜덤하게 배정될 타이밍을 정함
  const minDelay = 1.2;
  const maxDelay = 1.6;
  const baseSteps = 24;
  const cellSteps = activeCells.map(() =>
    Math.floor(baseSteps * (minDelay + Math.random() * (maxDelay - minDelay)))
  );

  let currentStep = 0;
  let interval = 8;

  activeCells.forEach(cell => cell.classList.add('shaking'));

  function rollingStep() {
    activeCells.forEach((cell, i) => {
      if (currentStep < cellSteps[i]) {
        cell.innerText = Math.floor(Math.random() * total) + 1;
        cell.classList.remove('fade-slide');
        void cell.offsetWidth;
        cell.classList.add('fade-slide');
      } else if (!cell.classList.contains('assigned')) {
        // 배정 타이밍이 되면 바로 실제 번호로 고정
        cell.innerText = numbers[i];
        cell.classList.remove('shaking');
        cell.classList.add("assigned");
        cell.classList.remove('fade-slide');
        void cell.offsetWidth;
        cell.classList.add('fade-slide');
        cell.style.transition = "box-shadow 0.4s, background 0.4s";
        cell.style.boxShadow = "0 0 24px 6px #43e97b88";
        setTimeout(() => {
          cell.style.boxShadow = "";
          cell.style.transition = "";
        }, 700);

        // 클릭 시 toggleCell만 동작(원래대로)
        cell.onclick = () => toggleCell(cell);
      }
    });
    currentStep++;
    if (activeCells.every((cell, i) => cell.classList.contains('assigned'))) {
      return;
    }
    // 룰렛 가속도 느낌: 처음엔 아주 빠르게, 후반부로 갈수록 지수적으로 느려짐
    const progress = currentStep / (baseSteps * maxDelay);
    interval = 8 + Math.pow(progress, 2.5) * 120;
    setTimeout(rollingStep, interval);
  }
  rollingStep();
}

function resetAllCells() {
  document.querySelectorAll('.cell').forEach(cell => {
    cell.dataset.active = "false";
    cell.classList.remove("active", "assigned");
    cell.innerText = "";
  });
  updateStudentCount();
}

// Fisher-Yates shuffle
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// 대한민국 현재 시각 표시
function updateClock() {
  const now = new Date();
  const options = {
    timeZone: 'Asia/Seoul',
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  };
  const kor = now.toLocaleString('ko-KR', options);
  document.getElementById('clock').innerText = `현재 시각: ${kor}`;
}
setInterval(updateClock, 1000);
updateClock();

// 최초 학생 수 표시
updateStudentCount();
</script>
</body>
</html>
