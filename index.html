<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìë¦¬ ë½‘ê¸° í”„ë¡œê·¸ë¨</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .student-count {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #1976d2;
      font-weight: bold;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 50px);
      grid-template-rows: repeat(6, 50px);
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      transition: all 0.3s;
      perspective: 700px;
    }
    .cell {
      width: 50px;
      height: 50px;
      border: 1px solid #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: linear-gradient(135deg, #f8fafc 60%, #e3f2fd 100%);
      border: 1.5px solid #b0bec5;
      border-radius: 6px;
      font-weight: bold;
      user-select: none;
      transition: background 0.3s, color 0.3s, transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.10), 0 1.5px 4px rgba(76, 175, 80, 0.08);
    }
    .cell.active {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      color: #fff;
      border: 2.5px solid #43e97b;
      animation: pop 0.22s;
      transform: scale(1.04);
      box-shadow: 0 4px 16px rgba(67, 233, 123, 0.18);
    }
    .cell.assigned {
      background: linear-gradient(135deg, #1976d2 60%, #64b5f6 100%) !important;
      color: #fff !important;
      border: 2.5px solid #1976d2;
      animation: assignPop 0.4s;
      box-shadow: 0 4px 16px rgba(25, 118, 210, 0.18);
      transition: background 0.7s, color 0.7s, border 0.7s;
    }
    .cell.fixed {
      background: repeating-linear-gradient(135deg, #fffbe7 0 8px, #ffe082 8px 16px);
      color: #bfa600 !important;
      border: 2.5px solid #ffb300 !important;
    }
    button {
      margin-top: 15px;
      padding: 12px 22px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(90deg, #1976d2 60%, #43e97b 100%);
      color: #fff;
      font-weight: bold;
      font-size: 1.08em;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.10);
      transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
    }
    button:hover {
      background: linear-gradient(90deg, #125ea7 60%, #43e97b 100%);
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 4px 16px rgba(25, 118, 210, 0.18);
    }
    @keyframes pop {
      0% { transform: scale(0.8);}
      80% { transform: scale(1.12);}
      100% { transform: scale(1.08);}
    }
    @keyframes assignPop {
      0% { background: #4caf50; transform: scale(1);}
      60% { background: #1976d2; transform: scale(1.18);}
      100% { background: #1976d2; transform: scale(1);}
    }
    @keyframes fadeSlide {
      0% {
        opacity: 0;
        transform: translateY(12px) scale(0.9);
      }
      60% {
        opacity: 1;
        transform: translateY(-4px) scale(1.12);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1.04);
      }
    }
    .fade-slide {
      animation: fadeSlide 0.28s cubic-bezier(.68,-0.55,.27,1.55);
    }
    @keyframes shake {
      0% { transform: scale(1.04) rotate(0deg);}
      20% { transform: scale(1.08) rotate(-2deg);}
      40% { transform: scale(1.10) rotate(2deg);}
      60% { transform: scale(1.08) rotate(-1deg);}
      80% { transform: scale(1.04) rotate(1deg);}
      100% { transform: scale(1.04) rotate(0deg);}
    }
    .shaking {
      animation: shake 0.6s infinite;
    }
    .grid.blur {
      filter: blur(3px) brightness(0.9);
      pointer-events: none;
      transition: filter 0.3s;
    }
    /* ëª¨ë°”ì¼ ëŒ€ì‘ */
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: repeat(5, 36px);
        grid-template-rows: repeat(12, 36px);
        gap: 6px;
      }
      .cell {
        width: 36px;
        height: 36px;
        font-size: 0.95em;
      }
    }
    @media (max-width: 400px) {
      .grid {
        grid-template-columns: repeat(3, 28px);
        grid-template-rows: repeat(20, 28px);
        gap: 4px;
      }
      .cell {
        width: 28px;
        height: 28px;
        font-size: 0.8em;
      }
    }
  </style>
</head>
<body>
  <h1>ìë¦¬ ë½‘ê¸° í”„ë¡œê·¸ë¨ ğŸ²</h1>
  <div id="clock" style="font-size:1.15em; font-weight:bold; color:#1976d2; margin-bottom:8px;"></div>
  <div class="student-count" id="studentCount">í•™ìƒ ìˆ˜: 0</div>
  <p>ì¹¸ì„ í´ë¦­í•´ í™œì„±í™”/ë¹„í™œì„±í™” ì‹œí‚¨ ë’¤ "ìë¦¬ ë½‘ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>

  <button onclick="assignSeats()">ìë¦¬ ë½‘ê¸°</button>
  <button
    onclick="resetAllCells()"
    style="margin-left:10px; background:linear-gradient(90deg,#1976d2 60%,#43e97b 100%); color:#fff; border:none;"
  >
    ì „ì²´ ì´ˆê¸°í™”
  </button>

  <div style="margin:14px 0 0 0;">
    <label style="display:inline-flex;align-items:center;gap:6px;">
      <input type="checkbox" id="dramaticMode" style="accent-color:#1976d2;">
      <span style="font-size:1em;color:#1976d2;font-weight:bold;">ê¸´ì¥ê° ë„˜ì¹˜ëŠ” ìë¦¬ë°°ì¹˜</span>
    </label>
  </div>

  <div class="grid" id="grid" style="margin-top:32px;"></div>

<script>
let rows = 6;
let cols = 10;
const grid = document.getElementById("grid");
const studentCount = document.getElementById("studentCount");

// ê²©ì ìƒì„± í•¨ìˆ˜
function createGrid() {
  grid.innerHTML = "";
  grid.style.gridTemplateColumns = `repeat(${cols}, 50px)`;
  grid.style.gridTemplateRows = `repeat(${rows}, 50px)`;
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.active = "false";
      cell.onclick = () => toggleCell(cell);
      grid.appendChild(cell);
    }
  }
  updateStudentCount();
}
createGrid();

function updateStudentCount() {
  const count = document.querySelectorAll(".cell[data-active='true']").length;
  studentCount.innerText = `í•™ìƒ ìˆ˜: ${count}`;
}

// ê¸°ì¡´ ì¹¸ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜
function toggleCell(cell) {
  if (cell.dataset.active === "false") {
    cell.dataset.active = "true";
    cell.classList.add("active");
    cell.classList.remove("assigned");
  } else {
    cell.dataset.active = "false";
    cell.classList.remove("active", "assigned");
    cell.innerText = ""; // ë¹„í™œì„±í™” ì‹œ ìˆ«ì ì œê±°
  }
  updateStudentCount();
}

let isDragging = false;
let dragMode = null;
let dragStartCell = null;

// PC ë§ˆìš°ìŠ¤
grid.addEventListener('mousedown', e => {
  if (e.target.classList.contains('cell')) {
    isDragging = true;
    dragStartCell = e.target;
    dragMode = e.target.dataset.active === "true" ? "off" : "on";
    toggleCellByDrag(e.target);
  }
});
grid.addEventListener('mouseover', e => {
  if (isDragging && e.target.classList.contains('cell')) {
    toggleCellByDrag(e.target);
  }
});
window.addEventListener('mouseup', e => {
  if (isDragging && dragStartCell && e.target === dragStartCell) {
    toggleCell(dragStartCell);
  }
  isDragging = false;
  dragMode = null;
  dragStartCell = null;
});

// ëª¨ë°”ì¼ í„°ì¹˜
let lastTouchedCell = null;
let touchStartCell = null;
grid.addEventListener('touchstart', e => {
  const touch = e.touches[0];
  const target = document.elementFromPoint(touch.clientX, touch.clientY);
  if (target && target.classList.contains('cell')) {
    isDragging = true;
    dragMode = target.dataset.active === "true" ? "off" : "on";
    lastTouchedCell = target;
    touchStartCell = target;
    toggleCellByDrag(target);
  }
});
grid.addEventListener('touchmove', e => {
  if (!isDragging) return;
  const touch = e.touches[0];
  const target = document.elementFromPoint(touch.clientX, touch.clientY);
  if (target && target.classList.contains('cell') && target !== lastTouchedCell) {
    toggleCellByDrag(target);
    lastTouchedCell = target;
  }
});
window.addEventListener('touchend', e => {
  if (isDragging && touchStartCell && lastTouchedCell === touchStartCell) {
    toggleCell(touchStartCell);
  }
  isDragging = false;
  dragMode = null;
  lastTouchedCell = null;
  touchStartCell = null;
});

// ë“œë˜ê·¸ í™œì„±í™”/ë¹„í™œì„±í™”
function toggleCellByDrag(cell) {
  if (dragMode === "on" && cell.dataset.active === "false") {
    cell.dataset.active = "true";
    cell.classList.add("active");
    cell.classList.remove("assigned");
    updateStudentCount();
  } else if (dragMode === "off" && cell.dataset.active === "true") {
    cell.dataset.active = "false";
    cell.classList.remove("active", "assigned");
    cell.innerText = "";
    updateStudentCount();
  }
}

// ìë¦¬ ë°°ì •
function assignSeats() {
  const activeCells = Array.from(document.querySelectorAll(".cell[data-active='true']"));
  const total = activeCells.length;
  if (total === 0) {
    alert("í™œì„±í™”ëœ ìë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }

  const dramatic = document.getElementById('dramaticMode').checked;
  const numbers = Array.from({ length: total }, (_, i) => i + 1);
  shuffle(numbers);

  // ëª¨ë“  ì¹¸ì—ì„œ ì´ì „ ë°°ì • íš¨ê³¼ ì œê±°
  document.querySelectorAll(".cell.assigned").forEach(cell => cell.classList.remove("assigned"));

  if (!dramatic) {
    activeCells.forEach((cell, i) => {
      cell.innerText = numbers[i];
      cell.classList.add("assigned");
    });
    return;
  }

  // ê° ì¹¸ë§ˆë‹¤ ëœë¤í•˜ê²Œ ë°°ì •ë  íƒ€ì´ë°ì„ ì •í•¨
  const minDelay = 1.2;
  const maxDelay = 1.6;
  const baseSteps = 24;
  const cellSteps = activeCells.map(() =>
    Math.floor(baseSteps * (minDelay + Math.random() * (maxDelay - minDelay)))
  );

  let currentStep = 0;
  let interval = 8;

  activeCells.forEach(cell => cell.classList.add('shaking'));

  function rollingStep() {
    activeCells.forEach((cell, i) => {
      if (currentStep < cellSteps[i]) {
        cell.innerText = Math.floor(Math.random() * total) + 1;
        cell.classList.remove('fade-slide');
        void cell.offsetWidth;
        cell.classList.add('fade-slide');
      } else if (!cell.classList.contains('assigned')) {
        // ë°°ì • íƒ€ì´ë°ì´ ë˜ë©´ ë°”ë¡œ ì‹¤ì œ ë²ˆí˜¸ë¡œ ê³ ì •
        cell.innerText = numbers[i];
        cell.classList.remove('shaking');
        cell.classList.add("assigned");
        cell.classList.remove('fade-slide');
        void cell.offsetWidth;
        cell.classList.add('fade-slide');
        cell.style.transition = "box-shadow 0.4s, background 0.4s";
        cell.style.boxShadow = "0 0 24px 6px #43e97b88";
        setTimeout(() => {
          cell.style.boxShadow = "";
          cell.style.transition = "";
        }, 700);

        // í´ë¦­ ì‹œ toggleCellë§Œ ë™ì‘(ì›ë˜ëŒ€ë¡œ)
        cell.onclick = () => toggleCell(cell);
      }
    });
    currentStep++;
    if (activeCells.every((cell, i) => cell.classList.contains('assigned'))) {
      return;
    }
    // ë£°ë › ê°€ì†ë„ ëŠë‚Œ: ì²˜ìŒì—” ì•„ì£¼ ë¹ ë¥´ê²Œ, í›„ë°˜ë¶€ë¡œ ê°ˆìˆ˜ë¡ ì§€ìˆ˜ì ìœ¼ë¡œ ëŠë ¤ì§
    const progress = currentStep / (baseSteps * maxDelay);
    interval = 8 + Math.pow(progress, 2.5) * 120;
    setTimeout(rollingStep, interval);
  }
  rollingStep();
}

function resetAllCells() {
  document.querySelectorAll('.cell').forEach(cell => {
    cell.dataset.active = "false";
    cell.classList.remove("active", "assigned");
    cell.innerText = "";
  });
  updateStudentCount();
}

// Fisher-Yates shuffle
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// ëŒ€í•œë¯¼êµ­ í˜„ì¬ ì‹œê° í‘œì‹œ
function updateClock() {
  const now = new Date();
  const options = {
    timeZone: 'Asia/Seoul',
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  };
  const kor = now.toLocaleString('ko-KR', options);
  document.getElementById('clock').innerText = `í˜„ì¬ ì‹œê°: ${kor}`;
}
setInterval(updateClock, 1000);
updateClock();

// ìµœì´ˆ í•™ìƒ ìˆ˜ í‘œì‹œ
updateStudentCount();
</script>
</body>
</html>
